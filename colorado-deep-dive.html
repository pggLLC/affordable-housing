<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Colorado Affordable Housing Deep Dive</title>

  <!-- Site styles (keep if present in your repo) -->
  <link rel="stylesheet" href="css/site-theme.css">
  <link rel="stylesheet" href="css/styles.css">

  <!-- Leaflet (for zoomable GeoJSON/feature layers) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <style>
    /* Hard guardrails so this page stays legible even if other CSS overrides it */
    :root{
      --bg:#0b0f14; --surface:#111a24; --surface2:#0e141d; --border:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.72); --link:rgba(180,210,255,.95);
    }
    html,body{background:var(--bg) !important; color:var(--text) !important;}
    a{color:var(--link) !important;}
    .page-wrap{max-width:1100px; margin:0 auto; padding:1.25rem;}
    .hero{padding:1.25rem 0 0.75rem;}
    h1{font-size:1.65rem; margin:0 0 .35rem;}
    .subtitle{color:var(--muted); margin:0 0 1rem; line-height:1.45;}
    .grid{display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:.75rem; margin: .75rem 0 1rem;}
    @media (max-width: 900px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width: 520px){ .grid{grid-template-columns:1fr;} }
    .card{background:var(--surface); border:1px solid var(--border); border-radius:14px; padding: .85rem;}
    .kpi{font-size:1.15rem; font-weight:700; margin:0; }
    .kpi-label{color:var(--muted); font-size:.85rem; margin:.2rem 0 0;}
    .section{margin:1rem 0 1.25rem;}
    h2{font-size:1.15rem; margin:0 0 .5rem;}
    .controls{display:flex; flex-wrap:wrap; gap:.65rem; align-items:center; justify-content:space-between;}
    .toggles{display:flex; flex-wrap:wrap; gap:.6rem; align-items:center;}
    label.toggle{display:flex; gap:.35rem; align-items:center; color:var(--muted); font-size:.9rem;}
    #coMap{height:560px; width:100%; margin-top:.85rem; border-radius:14px; overflow:hidden; border:1px solid var(--border);}
    .two-col{display:grid; grid-template-columns: 1.5fr 1fr; gap:1rem; margin-top:.85rem;}
    @media (max-width: 900px){ .two-col{grid-template-columns:1fr;} }
    ul{margin:.25rem 0 0 1.1rem;}
    li{margin:.25rem 0; color:var(--muted);}
    .small{font-size:12px; color:var(--muted); margin-top:.5rem;}
    .legend-item{display:flex; gap:.5rem; align-items:center; color:var(--muted); margin:.25rem 0;}
    .swatch{display:inline-block; width:14px; height:10px; border-radius:3px; border:1px solid var(--border);}
    .dot{display:inline-block; width:10px; height:10px; border-radius:50%;}
    /* Leaflet legibility */
    .leaflet-tooltip{
      background: rgba(15,22,32,0.92) !important;
      color: rgba(255,255,255,0.92) !important;
      border: 1px solid rgba(255,255,255,0.14) !important;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35) !important;
    }
    .leaflet-popup-content-wrapper, .leaflet-popup-tip{
      background: rgba(17,26,36,0.98) !important;
      color: rgba(255,255,255,0.92) !important;
    }
  </style>
</head>
<body data-page="colorado-deep-dive.html">
  <div id="site-header"></div>

  <main class="page-wrap">
    <header class="hero">
      <h1>Colorado Affordable Housing Market Deep Dive</h1>
      <p class="subtitle">
        Zoomable Colorado basemap with counties + municipalities, plus LIHTC projects and HUD 2026 QCT/DDA overlays.
        Use the toggles to explore and filter.
      </p>
    </header>

    <section class="grid" aria-label="Key metrics">
      <div class="card"><p class="kpi" id="kpiAlloc">$287M</p><p class="kpi-label">Annual LIHTC Allocation</p></div>
      <div class="card"><p class="kpi" id="kpiActive">78</p><p class="kpi-label">Active Projects</p></div>
      <div class="card"><p class="kpi" id="kpiVacancy">7.6%</p><p class="kpi-label">Denver Vacancy Rate (Q4 2025)</p></div>
      <div class="card"><p class="kpi" id="kpiConcession">$169</p><p class="kpi-label">Avg Monthly Concession</p></div>
    </section>

    <section class="section">
      <div class="card" style="padding:1rem;">
        <div class="controls">
          <div>
            <h2 style="margin:0;">Interactive Map: Counties, Places, LIHTC, QCT/DDA</h2>
            <div class="small">Tip: zoom in for municipal boundaries; click LIHTC points for project details.</div>
          </div>
          <div class="toggles" role="group" aria-label="Map layers and filters">
            <label class="toggle"><input type="checkbox" id="layerCounties" checked> Counties</label>
            <label class="toggle"><input type="checkbox" id="layerPlaces"> Places</label>
            <label class="toggle"><input type="checkbox" id="layerQCT" checked> QCT overlay (2026)</label>
            <label class="toggle"><input type="checkbox" id="layerDDA" checked> DDA overlay (2026)</label>
            <label class="toggle"><input type="checkbox" id="filterQCT"> Only QCT projects</label>
            <label class="toggle"><input type="checkbox" id="filterDDA"> Only DDA projects</label>
          </div>
        </div>

        <div id="coMap" aria-label="Colorado map"></div>

        <div class="two-col">
          <div>
            <div style="font-weight:700; margin-bottom:.25rem;">Data sources</div>
            <ul>
              <li><a href="https://www.policymap.com/data/sources/hud-lihtc" target="_blank" rel="noopener">PolicyMap: HUD LIHTC (source page)</a></li>
              <li><a href="https://www.huduser.gov/lihtc/" target="_blank" rel="noopener">HUD LIHTC Database (downloads & documentation)</a></li>
              <li><a href="https://egis.hud.gov/arcgis/rest/services/affht/AffhtMapService/MapServer/30" target="_blank" rel="noopener">HUD eGIS LIHTC map service (layer 30)</a></li>
              <li><a href="https://www.huduser.gov/portal/sadda/sadda_qct.html" target="_blank" rel="noopener">HUD QCT / (Small) DDA resources</a></li>
              <li><a href="https://gis.colorado.gov/public/rest/services/OIT/Colorado_State_Basemap/MapServer" target="_blank" rel="noopener">Colorado State Basemap (counties & municipalities)</a></li>
            </ul>
            <div class="small">
              Notes: LIHTC points represent general property locations (not building footprints). QCT/DDA overlays are loaded from HUD-published ArcGIS services when available.
            </div>
          </div>

          <div>
            <div style="font-weight:700; margin-bottom:.25rem;">Legend</div>
            <div class="legend-item"><span class="dot" style="background:#5fa8ff;"></span> LIHTC project</div>
            <div class="legend-item"><span class="swatch" style="background:rgba(120,255,170,.22); border-color:rgba(120,255,170,.45)"></span> QCT overlay</div>
            <div class="legend-item"><span class="swatch" style="background:rgba(255,200,90,.20); border-color:rgba(255,200,90,.45)"></span> DDA overlay</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="site-footer"></div>

  <script src="js/navigation.js"></script>
  <script src="js/contrast-guard.js"></script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script src="js/co-lihtc-map.js"></script>
</body>
</html>
