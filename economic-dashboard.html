<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Economic Dashboard | Affordable Housing</title>
<meta content="Real-time economic indicators from FRED affecting affordable housing development." name="description"/>
<!-- Chart.js (client-side) -->
<script src="js/config.js"></script>
<script src="js/api-config-wrapper.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js"></script>
<script defer="defer" src="js/navigation.js"></script><link href="css/site-theme.css" rel="stylesheet"/>
</head>
<body>
<!-- Navigation (mimics HousingMetrics style) -->
<main class="container">

<section class="hero">
<div class="kicker">Real-time • FRED</div>
<h1>Economic Dashboard</h1>
<p class="sub">
        Live economic indicators from the Federal Reserve Economic Data (FRED) that influence affordable housing development:
        construction costs, interest rates, labor, and housing market conditions.
      </p>
<div class="toolbar">
<div class="card control" style="flex-wrap:wrap;">
<span class="pill">FRED connected: <strong id="conn">…</strong></span>
<span class="pill">Indicators: <strong id="count">—</strong></span>
<span class="pill">Last updated: <strong id="lastUpdated">—</strong></span>
<button class="btn primary" id="refresh" type="button">Refresh</button>
</div>
</div>
<div class="grid">
<div class="card stat">
<p class="num" id="statCpi">—</p>
<p class="lbl">Inflation (CPI YoY)</p>
<p class="src small"><a href="https://fred.stlouisfed.org/series/CPIAUCSL" rel="noopener" target="_blank">Source: FRED (CPIAUCSL)</a></p></div>
<div class="card stat">
<p class="num" id="statUnemp">—</p>
<p class="lbl">Unemployment rate</p>
<p class="src small"><a href="https://fred.stlouisfed.org/series/UNRATE" rel="noopener" target="_blank">Source: FRED (UNRATE)</a></p></div>
<div class="card stat">
<p class="num" id="stat10y">—</p>
<p class="lbl">10-Year Treasury</p>
<p class="src small"><a href="https://fred.stlouisfed.org/series/DGS10" rel="noopener" target="_blank">Source: FRED (DGS10)</a></p></div>
<div class="card stat">
<p class="num" id="statStarts">—</p>
<p class="lbl">Housing starts (SAAR)</p>
<p class="src small"><a href="https://fred.stlouisfed.org/series/HOUST" rel="noopener" target="_blank">Source: FRED (HOUST)</a></p></div>
</div>
<p class="note">
        Data source: <a href="https://fred.stlouisfed.org" rel="noopener" target="_blank">FRED</a>, Federal Reserve Bank of St. Louis.
        If charts don’t load, confirm your key is valid and check browser console for errors.
      </p>
</section><section id="census-stats" style="margin:18px 0; padding:18px;"><h2>Census snapshot</h2><div class="census-controls"><label>Geography<select id="censusLevel"><option value="state">State</option><option value="county">County</option><option value="place">Place</option></select></label><label id="censusStateWrap">State<select id="censusState"></select></label><label>Select<select id="censusGeo"></select></label><div class="census-vintage" data-census-vintage="">Loading…</div></div><div class="census-grid"></div></section>
<!-- Collapsible sections (Nixvir-like: metric cards with inline charts) -->
<details class="card" open="">
<summary>
        Construction Costs
        <span class="pill small">6 indicators</span>
</summary>
<div class="section-body">
<p class="section-desc">Producer price indices and cost proxies that impact per-unit construction budgets and feasibility.</p>
<div class="metric-grid" id="sec-construction"></div>
</div>
</details>
<details class="card">
<summary>
        Housing Market
        <span class="pill small">6 indicators</span>
</summary>
<div class="section-body">
<p class="section-desc">Starts, permits, prices, and affordability signals that shape pipeline and underwriting assumptions.</p>
<div class="metric-grid" id="sec-housing"></div>
</div>
</details>
<details class="card">
<summary>
        Financial &amp; Interest Rates
        <span class="pill small">6 indicators</span>
</summary>
<div class="section-body">
<p class="section-desc">Rates and spreads that move equity pricing, permanent debt terms, and bond execution costs.</p>
<div class="metric-grid" id="sec-finance"></div>
</div>
</details>
<details class="card">
<summary>
        Labor Market
        <span class="pill small">6 indicators</span>
</summary>
<div class="section-body">
<p class="section-desc">Employment, earnings, and labor supply indicators relevant to labor cost pressure and demand.</p>
<div class="metric-grid" id="sec-labor"></div>
</div>
</details>
<p class="note small">
      Implementation notes: FRED data is fetched client-side via the FRED API “observations” endpoint.
      Some series update monthly or quarterly; charts show the most recent 5 years (or max available if shorter).
    </p>
</main>
<script>
(() => {
  const CONFIG_KEY = (window.APP_CONFIG && window.APP_CONFIG.FRED_API_KEY) ? window.APP_CONFIG.FRED_API_KEY : "";

  // Keep your "desired indicators" (24) but render them nixvir-style.
  const INDICATORS = [
    // Construction (6)
    {section:"construction", id:"WPUFD49207", title:"PPI: Inputs to construction", units:"index", fmt:"index"},
    {section:"construction", id:"WPUSI012011", title:"PPI: Lumber & wood products", units:"index", fmt:"index"},
    {section:"construction", id:"WPUFD4", title:"PPI: Construction materials", units:"index", fmt:"index"},
    {section:"construction", id:"PCU236115236115", title:"PPI: New multifamily construction", units:"index", fmt:"index"},
    {section:"construction", id:"CES2000000008", title:"Construction Avg Hourly Earnings", units:"$/hr", fmt:"usd"},
    {section:"construction", id:"ECIALLCIV", title:"Employment Cost Index (Total comp)", units:"index", fmt:"index"},

    // Housing (6)
    {section:"housing", id:"HOUST", title:"Housing Starts (SAAR)", units:"thousands", fmt:"int"},
    {section:"housing", id:"PERMIT", title:"Building Permits (SAAR)", units:"thousands", fmt:"int"},
    {section:"housing", id:"CSUSHPISA", title:"Case-Shiller Home Price Index", units:"index", fmt:"index"},
    {section:"housing", id:"MSPUS", title:"Median Sales Price of Houses", units:"$", fmt:"usd"},
    {section:"housing", id:"RHORUSQ156N", title:"Homeownership Rate", units:"%", fmt:"pct"},
    {section:"housing", id:"RRVRUSQ156N", title:"Rental Vacancy Rate", units:"%", fmt:"pct"},

    // Finance (6)
    {section:"finance", id:"DGS10", title:"10-Year Treasury Yield", units:"%", fmt:"pct"},
    {section:"finance", id:"DGS2", title:"2-Year Treasury Yield", units:"%", fmt:"pct"},
    {section:"finance", id:"DFF", title:"Effective Fed Funds Rate", units:"%", fmt:"pct"},
    {section:"finance", id:"MORTGAGE30US", title:"30-Year Fixed Mortgage Rate", units:"%", fmt:"pct"},
    {section:"finance", id:"BAA10Y", title:"Moody’s Baa - 10Y Treasury Spread", units:"pts", fmt:"pct"},
    {section:"finance", id:"T10Y2Y", title:"Yield Curve (10Y-2Y)", units:"pts", fmt:"pct"},

    // Labor (6)
    {section:"labor", id:"UNRATE", title:"Unemployment Rate", units:"%", fmt:"pct"},
    {section:"labor", id:"PAYEMS", title:"Nonfarm Payrolls", units:"thousands", fmt:"int"},
    {section:"labor", id:"CIVPART", title:"Labor Force Participation", units:"%", fmt:"pct"},
    {section:"labor", id:"CES0500000003", title:"Average Hourly Earnings", units:"$", fmt:"usd"},
    {section:"labor", id:"JTSJOL", title:"Job Openings (JOLTS)", units:"thousands", fmt:"int"},
    {section:"labor", id:"ICSA", title:"Initial Jobless Claims", units:"count", fmt:"int"}
  ];

  const els = {
    
    
    
    conn: document.getElementById("conn"),
    refresh: document.getElementById("refresh"),
    lastUpdated: document.getElementById("lastUpdated"),
    count: document.getElementById("count"),
    statCpi: document.getElementById("statCpi"),
    statUnemp: document.getElementById("statUnemp"),
    stat10y: document.getElementById("stat10y"),
    statStarts: document.getElementById("statStarts"),
    sec: {
      construction: document.getElementById("sec-construction"),
      housing: document.getElementById("sec-housing"),
      finance: document.getElementById("sec-finance"),
      labor: document.getElementById("sec-labor"),
    }
  };

  if (els.count) els.count.textContent = String(INDICATORS.length);
function getKey(){ return CONFIG_KEY || ""; }
    
  function fmtValue(v, fmt){
    const n = Number(v);
    if (!isFinite(n)) return "—";
    if (fmt === "pct") return n.toFixed(2).replace(/\.00$/,"") + "%";
    if (fmt === "usd") {
      // show no decimals for large numbers, two decimals for small
      const abs = Math.abs(n);
      const decimals = abs >= 100 ? 0 : 2;
      return n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:decimals});
    }
    if (fmt === "int") return Math.round(n).toLocaleString();
    return n.toLocaleString(undefined,{maximumFractionDigits:2});
  }

  function deltaClass(d){
    if (!isFinite(d)) return "flat";
    if (d > 0) return "up";
    if (d < 0) return "down";
    return "flat";
  }
  function arrow(d){
    if (!isFinite(d)) return "→";
    if (d > 0) return "↑";
    if (d < 0) return "↓";
    return "→";
  }

  // Data is pre-fetched daily by a GitHub Action (.github/workflows/fetch-fred-data.yml)
  // and stored in data/fred-data.json — no CORS issues, no API key needed in browser.
  let _fredCache = null;
  async function _loadFredData(){
    if (_fredCache) return _fredCache;
    const res = await fetch("data/fred-data.json");
    if (!res.ok) throw new Error("Could not load data/fred-data.json (HTTP " + res.status + ")");
    _fredCache = await res.json();
    return _fredCache;
  }

  async function fetchFRED(seriesId, apiKey, limit=84){
    const data = await _loadFredData();
    const entry = data.series && data.series[seriesId];
    if (!entry || !entry.observations) throw new Error(seriesId + ": series not found in cached data");
    const obs = entry.observations
      .filter(o => o && o.value !== "." && o.value !== null && o.date)
      .map(o => ({date: o.date, value: Number(o.value)}))
      .filter(o => isFinite(o.value));
    // Apply limit from tail (most recent)
    const sliced = obs.slice(-limit);
    if (!sliced.length) throw new Error(seriesId + " no observations");
    return sliced;
  }

  function buildMetricCard(ind){
    const idSafe = ind.id.replace(/[^a-zA-Z0-9_-]/g,"_");
    const wrap = document.createElement("div");
    wrap.className = "card metric";
    wrap.innerHTML = `
      <h3><a href="https://fred.stlouisfed.org/series/${encodeURIComponent(ind.id)}" target="_blank" rel="noopener">${ind.title}</a></h3>
      <p class="value" id="val-${idSafe}">Loading…</p>
      <div class="meta">
        <span id="date-${idSafe}">—</span>
        <span class="delta flat" id="delta-${idSafe}">—</span>
      </div>
      <div class="chart-wrap">
        <canvas id="ch-${idSafe}" aria-label="${ind.title} chart"></canvas>
        <div class="small" id="err-${idSafe}" style="margin-top:8px;"></div>
      </div>
    `;
    return wrap;
  }

  const charts = new Map();

  function renderChart(canvas, labels, values){
    const ctx = canvas.getContext("2d");
    const existing = charts.get(canvas.id);
    if (existing) existing.destroy();

    const ch = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "",
          data: values,
          pointRadius: 0,
          borderWidth: 2,
          tension: 0.25
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false }, tooltip: { mode: "index", intersect: false } },
        scales: {
          x: { ticks: { maxTicksLimit: 6 }, grid: { display: false } },
          y: { ticks: { maxTicksLimit: 5 }, grid: { color: "rgba(148,163,184,.22)" } }
        }
      }
    });

    charts.set(canvas.id, ch);
  }

  function monthLabel(iso){
    // "2026-01-01" -> "Jan 26"
    const d = new Date(iso + "T00:00:00");
    if (isNaN(d.getTime())) return iso;
    return d.toLocaleString(undefined, {month:"short", year:"2-digit"});
  }

  function pickChange(series){
    // Prefer YoY if enough history, else last period change
    if (series.length < 2) return {delta: NaN, label:"—"};
    const last = series[series.length - 1].value;
    // Find ~12 periods back if dates are monthly-ish. If not, use previous point.
    const idx = Math.max(0, series.length - 13);
    const prev = series[idx].value;
    const delta = last - prev;
    // If we likely used YoY, label it; else generic chg
    const label = (series.length >= 13) ? "YoY" : "chg";
    return {delta, label};
  }

  async function loadAll(){
    const apiKey = getKey();
    if (els.conn) els.conn.textContent = apiKey ? "Yes" : "No";

    // Build cards if not built yet
    for (const s of Object.values(els.sec)) s.innerHTML = "";
    for (const ind of INDICATORS){
      els.sec[ind.section].appendChild(buildMetricCard(ind));
    }

    if (!apiKey){
      // show placeholders
      if (els.lastUpdated) els.lastUpdated.textContent = "—";
      return;
    }

    // Load headline stats (CPI YoY, UNRATE, DGS10, HOUST)
    // CPI YoY uses CPIAUCSL % change YoY: compute from CPI level series.
    try{
      const [cpi, unemp, teny, starts] = await Promise.all([
        fetchFRED("CPIAUCSL", apiKey, 90),
        fetchFRED("UNRATE", apiKey, 90),
        fetchFRED("DGS10", apiKey, 90),
        fetchFRED("HOUST", apiKey, 90),
      ]);

      // CPI YoY
      const last = cpi[cpi.length-1];
      const prev = cpi[Math.max(0, cpi.length-13)];
      const yoy = (last.value/prev.value - 1) * 100;
      els.statCpi.textContent = yoy.toFixed(1) + "%";

      els.statUnemp.textContent = fmtValue(unemp[unemp.length-1].value, "pct");
      els.stat10y.textContent = fmtValue(teny[teny.length-1].value, "pct");
      els.statStarts.textContent = (Math.round(starts[starts.length-1].value) * 1000).toLocaleString() + " /yr";
    } catch(e){
      // don't hard fail the whole page
      console.warn("Headline stats failed:", e);
    }

    // Load all indicator series and render
    // Show when the cached FRED data was last fetched by the GitHub Action
    try {
      const meta = await _loadFredData();
      if (meta.updated) {
        const updatedAt = new Date(meta.updated);
        els.lastUpdated.textContent = "Data as of " + updatedAt.toLocaleDateString(undefined,{year:"numeric",month:"short",day:"numeric"});
      }
    } catch(e) {}

    await Promise.all(INDICATORS.map(async (ind) => {
      const idSafe = ind.id.replace(/[^a-zA-Z0-9_-]/g,"_");
      const valEl = document.getElementById(`val-${idSafe}`);
      const dateEl = document.getElementById(`date-${idSafe}`);
      const deltaEl = document.getElementById(`delta-${idSafe}`);
      const errEl = document.getElementById(`err-${idSafe}`);
      const canvas = document.getElementById(`ch-${idSafe}`);

      try{
        errEl.textContent = "";
        const series = await fetchFRED(ind.id, apiKey, 120);
        const last = series[series.length-1];
        valEl.textContent = fmtValue(last.value, ind.fmt);
        dateEl.textContent = monthLabel(last.date);

        const change = pickChange(series);
        const cls = deltaClass(change.delta);
        const arr = arrow(change.delta);

        let deltaText = "—";
        if (isFinite(change.delta)){
          if (ind.fmt === "pct") {
            deltaText = `${arr} ${change.delta.toFixed(2)} pts ${change.label}`;
          } else if (ind.fmt === "usd" || ind.fmt === "index" || ind.fmt === "int") {
            // percent change is more intuitive for these
            const base = series[Math.max(0, series.length-13)].value;
            const pct = base ? ((last.value/base - 1)*100) : NaN;
            if (isFinite(pct)) deltaText = `${arr} ${pct.toFixed(1)}% ${change.label}`;
            else deltaText = `${arr} ${change.delta.toFixed(2)} ${change.label}`;
          } else {
            deltaText = `${arr} ${change.delta.toFixed(2)} ${change.label}`;
          }
        }

        deltaEl.className = `delta ${cls}`;
        deltaEl.textContent = deltaText;

        const labels = series.map(p => monthLabel(p.date));
        const values = series.map(p => p.value);
        renderChart(canvas, labels, values);
      } catch(e){
        console.warn("Indicator failed:", ind.id, e);
        valEl.textContent = "—";
        dateEl.textContent = "—";
        deltaEl.className = "delta flat";
        deltaEl.textContent = "—";
        errEl.innerHTML = `<span class="err">Data unavailable:</span> ${String(e.message || e)}`;
      }
    }));
  }

  // Init controls
  els.conn.textContent = getKey() ? "Yes" : "No";
  if (els.lastUpdated) els.lastUpdated.textContent = "—";
  els.refresh.addEventListener("click", () => loadAll());

  // Load on start
  loadAll();
})();
</script>
<script src="js/contrast-guard.js"></script><script src="js/census-geo.js"></script><script src="js/fred-cards.js"></script>


<script id="fred-kpi-inline-loader">
(async function () {
  try {
    const key = window.APP_CONFIG && window.APP_CONFIG.FRED_API_KEY ? window.APP_CONFIG.FRED_API_KEY : "";
    if (!key) { console.warn("[kpi] Missing window.APP_CONFIG.FRED_API_KEY"); return; }

    const setTxt = (id, txt) => { const el = document.getElementById(id); if (el) el.textContent = txt; };

    async function latest(seriesId, params) {
      const url = new URL("https://api.stlouisfed.org/fred/series/observations");
      url.searchParams.set("api_key", key);
      url.searchParams.set("file_type", "json");
      url.searchParams.set("series_id", seriesId);
      url.searchParams.set("sort_order", "desc");
      url.searchParams.set("limit", "1");
      if (params) Object.entries(params).forEach(([k,v]) => url.searchParams.set(k, v));
      const res = await fetch(url.toString());
      if (!res.ok) throw new Error(seriesId + " HTTP " + res.status);
      const json = await res.json();
      const obs = json && json.observations && json.observations[0] ? json.observations[0] : null;
      if (!obs || obs.value === "." || obs.value == null) throw new Error(seriesId + " no value");
      return Number(obs.value);
    }

    // show loading
    ["statCpi","statUnemp","stat10y","statStarts"].forEach(id => setTxt(id, "Loading…"));

    // CPI YoY (pc1 = percent change from year ago)
    try { const v = await latest("CPIAUCSL", { units: "pc1" }); setTxt("statCpi", v.toFixed(1) + "%"); }
    catch(e){ console.warn(e); setTxt("statCpi","—"); }

    try { const v = await latest("UNRATE"); setTxt("statUnemp", v.toFixed(1) + "%"); }
    catch(e){ console.warn(e); setTxt("statUnemp","—"); }

    try { const v = await latest("DGS10"); setTxt("stat10y", v.toFixed(2) + "%"); }
    catch(e){ console.warn(e); setTxt("stat10y","—"); }

    // HOUST is "Thousands of Units" SAAR
    try { const v = await latest("HOUST"); const units = v*1000; setTxt("statStarts", (units>=1e6?(units/1e6).toFixed(2)+"M":units>=1e3?(units/1e3).toFixed(0)+"k":Math.round(units).toString())); }
    catch(e){ console.warn(e); setTxt("statStarts","—"); }

  } catch (err) {
    console.warn("[kpi] fatal", err);
  }
})();
</script>


<script>
/* KPI CARDS FROM CACHE OVERRIDE */
(function(){
  function set(id, val){ var el=document.getElementById(id); if(el) el.textContent=val; }
  function pct(n, d){ return d ? (100*n/d) : null; }
  function num(v){ var x = Number(v); return isFinite(x) ? x : null; }

  async function load(){
    try{
      const res = await fetch('data/fred-data.json', {cache:'no-store'});
      if(!res.ok) throw new Error('fred-data.json HTTP '+res.status);
      const data = await res.json();
      // expected shape: data.series[seriesId] = [{date,value},...]
      const series = data.series || data || {};
      function latestValue(id){
        const arr = series[id];
        if(!arr || !arr.length) return null;
        for(let i=arr.length-1;i>=0;i--){
          const v = arr[i].value ?? arr[i][1] ?? arr[i];
          const n = num(v);
          if(n!=null) return n;
        }
        return null;
      }
      function cpiYoY(){
        const arr = series['CPIAUCSL'];
        if(!arr || arr.length < 13) return null;
        // find last numeric
        let lastIdx = arr.length-1;
        while(lastIdx>=0){
          const v = num(arr[lastIdx].value ?? arr[lastIdx][1] ?? arr[lastIdx]);
          if(v!=null) { 
            const v12 = num((arr[lastIdx-12]||{}).value ?? (arr[lastIdx-12]||[])[1] ?? arr[lastIdx-12]);
            if(v12!=null && v12!==0) return (v - v12)/v12*100;
            return null;
          }
          lastIdx--;
        }
        return null;
      }

      const cpi = cpiYoY();
      const un = latestValue('UNRATE');
      const ten = latestValue('DGS10');
      const hs = latestValue('HOUST');

      set('statCpi', cpi==null ? '—' : cpi.toFixed(1)+'%');
      set('statUnemp', un==null ? '—' : un.toFixed(1)+'%');
      set('stat10y', ten==null ? '—' : ten.toFixed(2)+'%');
      set('statStarts', hs==null ? '—' : Math.round(hs).toLocaleString());

    } catch(e){
      console.warn('[kpi-cache] failed', e);
    }
  }
  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', load);
  else load();
})();
</script>

<script>
/* FRED CACHE ONLY OVERRIDE (v7) - avoid CORS by never calling api.stlouisfed.org from browser */
(function(){
  async function loadCache(){
    const res = await fetch('data/fred-data.json', {cache:'no-store'});
    if(!res.ok) throw new Error('fred-data.json HTTP '+res.status);
    return res.json();
  }
  function normalizeSeries(cache, id){
    const series = cache.series || cache || {};
    const arr = series[id];
    if(!arr || !arr.length) return null;
    // accept {date,value} or [date,value]
    return arr.map(o => {
      if(Array.isArray(o)) return {date:o[0], value:o[1]};
      return {date:o.date, value:o.value};
    }).filter(o => o.value !== "." && o.value != null);
  }
  function latest(arr){
    if(!arr || !arr.length) return null;
    for(let i=arr.length-1;i>=0;i--){
      const n = Number(arr[i].value);
      if(isFinite(n)) return n;
    }
    return null;
  }
  function cpiYoY(cpiArr){
    if(!cpiArr || cpiArr.length < 13) return null;
    const last = latest(cpiArr);
    if(last==null) return null;
    // find matching 12 months earlier by index (assumes monthly series)
    // use last index and last-12 within filtered array
    let idx = cpiArr.length-1;
    while(idx>=0 && !isFinite(Number(cpiArr[idx].value))) idx--;
    if(idx-12 < 0) return null;
    const prev = Number(cpiArr[idx-12].value);
    if(!isFinite(prev) || prev===0) return null;
    return (last - prev)/prev*100;
  }
  function set(id, txt){
    const el = document.getElementById(id);
    if(el) el.textContent = txt;
  }

  async function run(){
    try{
      const cache = await loadCache();
      const cpiArr = normalizeSeries(cache, 'CPIAUCSL');
      const unArr = normalizeSeries(cache, 'UNRATE');
      const tenArr = normalizeSeries(cache, 'DGS10');
      const hsArr = normalizeSeries(cache, 'HOUST');

      const cpi = cpiYoY(cpiArr);
      const un = latest(unArr);
      const ten = latest(tenArr);
      const hs = latest(hsArr);

      set('statCpi', cpi==null ? '—' : cpi.toFixed(1)+'%');
      set('statUnemp', un==null ? '—' : un.toFixed(1)+'%');
      set('stat10y', ten==null ? '—' : ten.toFixed(2)+'%');
      set('statStarts', hs==null ? '—' : Math.round(hs).toLocaleString());
    }catch(e){
      console.warn('[fred-cache-v7] KPI update failed', e);
    }
  }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', run);
  else run();
})();
</script>
</body>
</html>
